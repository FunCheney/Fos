
文件系统的整体架构自下而上可分为五层：

1. 磁盘块设备接口层：读写磁盘块设备的trait接口

   * 在 easy-fs/src/block_dev.rs 中，BlockDevice trait 代表了一个抽象块设备的接口。该 trait 仅需求两个函数 read_block 和 
     write_block ，分别代表将数据从块设备读到内存缓冲区中，或者将数据从内存缓冲区写回到块设备中，数据需要以块为单位进行读写。
   
   * easy-fs 库的使用者（如操作系统内核）需要实现块设备驱动程序，并实现 BlockDevice trait 以提供给 easy-fs 库使用，这样 easy-fs 库就与
     一个具体的执行环境对接起来了。
   
   * 为什么块设备层位于 easy-fs 的最底层，那是因为文件系统仅仅是在块设备上存储的稍微复杂一点的数据。无论对文件系统的操作如何复杂，
     从块设备的角度看，这些操作终究可以被分解成若干次基本的块读写操作。

2. 块缓存层：位于内存的磁盘块数据缓存
   * 在 easy-fs/src/block_cache.rs 中，BlockCache 代表一个被我们管理起来的块缓冲区，它包含块数据内容以及块的编号等信息。

   * 当它被创建的时候，将触发一次 read_block 将数据从块设备读到它的缓冲区中。接下来只要它驻留在内存中，便可保证对于同一个块的所有操作都会直接
     在它的缓冲区中进行而无需额外的 read_block 。块缓存管理器 BlockManager 在内存中管理有限个 BlockCache 并实现了类似 FIFO 的缓存替换算
     法，当一个块缓存被换出的时候视情况可能调用 write_block 将缓冲区数据写回块设备。总之，块缓存层对上提供 get_block_cache 接口来屏蔽掉相
     关细节，从而可以向上层子模块提供透明读写数据块的服务。
   
   * 尽管在操作系统的最底层（即块设备驱动程序）已经有了对块设备的读写能力，但从编程方便/正确性和读写性能的角度来看，仅有块读写这么基础的底层接
     口是不足以实现高效的文件系统。 比如，某应用将一个块的内容读到内存缓冲区，对缓冲区进行修改，并尚未写回块设备时，如果另外一个应用再次将该块
     的内容读到另一个缓冲区，而不是使用已有的缓冲区， 这将会造成数据不一致问题。此外还有可能增加很多不必要的块读写次数，大幅降低文件系统的性能。
     因此，通过程序自动而非程序员手动地对块缓冲区进行统一管理也就很必要了，该机制被我们抽象为 easy-fs 自底向上的第二层，即块缓存层。

3. 磁盘数据结构层：表示磁盘文件系统的数据结构
   * 有了块缓存，我们就可以在内存中方便地处理easyfs文件系统在磁盘上的各种数据了，这就是第三层文件系统的磁盘数据结构。easyfs文件系统中的所有需
     要持久保存的数据都会放到磁盘上，这包括了管理这个文件系统的 超级块 (Super Block)，管理空闲磁盘块的 索引节点位图区 和 数据块位图区 ，以及
     管理文件的 索引节点区 和 放置文件数据的 数据块区 组成。 

4. 磁盘块管理器层：实现对磁盘文件系统的管理
   * easyfs文件系统中管理这些磁盘数据的控制逻辑主要集中在 磁盘块管理器 中，这是文件系统的第四层。对于文件系统管理而言，其核心是
     EasyFileSystem 数据结构及其关键成员函数：
   ```rust
   
     EasyFileSystem.create：创建文件系统
     EasyFileSystem.open：打开文件系统
     EasyFileSystem.alloc_inode：分配inode （dealloc_inode未实现，所以还不能删除文件）
     EasyFileSystem.alloc_data：分配数据块
     EasyFileSystem.dealloc_data：回收数据块  
   ```

5. 索引节点层：实现文件创建/文件打开/文件读写等操作
   * 对于单个文件的管理和读写的控制逻辑主要是 索引节点（文件控制块） 来完成，这是文件系统的第五层，其核心是 Inode 数据结构及其关键成员函数：
   ```rust

    Inode.new：在磁盘上的文件系统中创建一个inode

    Inode.find：根据文件名查找对应的磁盘上的inode

    Inode.create：在根目录下创建一个文件

    Inode.read_at：根据inode找到文件数据所在的磁盘数据块，并读到内存中

    Inode.write_at：根据inode找到文件数据所在的磁盘数据块，把内存中数据写入到磁盘数据块中
   ```